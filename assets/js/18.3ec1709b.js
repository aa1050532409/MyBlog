(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{563:function(t,s,a){"use strict";a.r(s);var n=a(2),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("在做天气查询的时候，调用到腾讯地图API，遇到了跨域问题，跨域还是挺普遍的")]),t._v(" "),a("p",[t._v("所以来归纳一下跨域的解决方式吧（不全）")]),t._v(" "),a("h1",{attrs:{id:"什么是跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是跨域"}},[t._v("#")]),t._v(" 什么是跨域？")]),t._v(" "),a("p",[t._v("一般来说，跨域是一个网页去请求另一个不同源网页的资源时产生\n这是由浏览器同源策略限制的")]),t._v(" "),a("h1",{attrs:{id:"同源策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),a("p",[t._v("同源指的是“协议+域名+端口”三者相同，任何一个不同，就会产生跨域\n同源策略页数浏览器最核心和最基本的安全功能")]),t._v(" "),a("p",[t._v("同源策略限制javascript代码部分行为："),a("br"),t._v("\n1.Cookie、LocalStorage和IndexDB无法读取"),a("br"),t._v("\n2.DOM无法获得"),a("br"),t._v("\n3.AJAX请求不能发送")]),t._v(" "),a("h1",{attrs:{id:"一、vue-jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、vue-jsonp"}},[t._v("#")]),t._v(" 一、vue-jsonp")]),t._v(" "),a("p",[t._v("首先安装vue-jsonp")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[t._v("npm install vue-jsonp --save")])]),a("p",[t._v("在vue cli项目的main.js中添加，"),a("strong",[t._v("不要忘了{}")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[t._v("import { VueJsonp } form 'vue-jsonp'"),a("br"),t._v("\nVue.use(VueJsonp)")])]),a("p",[t._v("然后就可在任意一个.vue文件使用")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[t._v("可以直接使用this.$jsonp"),a("br"),t._v("\nVue.use(VueJsonp)方法将$jsonp赋给了vue原型: Vue.prototype.$jsonp = jsonp")])]),a("p",[t._v("当然，你也可以在某个Vue文件的script中直接添加使用")]),t._v(" "),a("p",[t._v("然后用法就是（这里用腾讯地图API举例，当然要真正使用还需去腾讯地图那设置ip白名单）")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[t._v('let url = "api地址"   // 具体API封装请自行查询'),a("br"),t._v("\nlet data = {"),a("br"),t._v('\n key: "腾讯地图API的key",'),a("br"),t._v('\n output: "jsonp"'),a("br"),t._v("\n}"),a("br"),t._v("\nthis.$jsonp(url, data)  // 可以看到jsonp返回的是promise对象"),a("br"),t._v("\n .then(res=>{})"),a("br"),t._v("\n .catch(error=>{})")])]),a("p",[a("strong",[t._v("jsonp的跨域原理")]),a("br"),t._v("\n不是发生ajax请求，而是script标签可以跨域。")]),t._v(" "),a("p",[t._v("用js构造一个script标签，把json的url赋给script的src属性，将这个\nscript标签插入到dom，让浏览器获取")]),t._v(" "),a("h1",{attrs:{id:"二、proxy本地代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、proxy本地代理"}},[t._v("#")]),t._v(" 二、proxy本地代理")]),t._v(" "),a("p",[t._v("在跟做云E办项目时，用到proxy代理获取后端的验证码（ps:他们没给我sql文件！我的项目进行不了！）")]),t._v(" "),a("p",[t._v("首先在vue项目根目录下，创建vue.config.js文件")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    devServer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 端口号"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        https"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        proxy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果是首页，那么这里就是'/'，也就是请求的位置路由")]),t._v("\n                ws"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不启动websocket")]),t._v("\n                target"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'目标地址'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                changeOrigin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//发生请求头host被置换为target")]),t._v("\n                pathRewrite"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^/api'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api'")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);